@using CkanDotNet.Api.Model
@using System.Text
@model Package

@{
    var formatTypes = CkanDotNet.Web.Models.Helpers.SettingsHelper.GetResourceSettings().Types;
}
<div class="package">

    <h1>@Model.Title</h1>

    <div class="tagline">
        @{
            StringBuilder sb = new StringBuilder();
            sb.AppendFormat("Posted {0}", Model.MetadataCreatedAsDate.ToShortDateString());

            if (Model.MetadataModifiedAsDate > DateTime.MinValue)
            {
                sb.AppendFormat(", last updated {0}", Model.MetadataModifiedAsDate.ToShortDateString());
            }
        }
        @sb.ToString()
    </div>

    <div class="notes">
        <p>@Model.Notes</p>
    </div>
    
    @* Show the resources *@
    <h3>Resources</h3>
    <table cellpadding="0" cellspacing="0">
        <thead>
            <tr>
                <th>Format</th>
                <th>Description</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
        @foreach (Resource resource in Model.Resources)
        {
            <tr>
                <td>
                    @if (!formatTypes.ContainsKey(resource.Format))
                    {
                        @resource.Format
                    }
                    else
                    {
                        <span class="tooltip" title="@formatTypes[resource.Format].Title">@resource.Format</span>
                    }
                    
                </td>
                <td>
                    @resource.Description
                </td>
                <td nowrap="nowrap">
                    @if (!formatTypes.ContainsKey(resource.Format))
                    {
                        <a href="@resource.Url">Download</a>
                    }
                    else
                    {
                        foreach (var action in formatTypes[resource.Format].Actions)
                        {
                            <a href="@action.BuildUrl(resource.Url)">@action.Action</a><br />
                        }
                    }
                </td>

            </tr>
        }
        </tbody>
    </table>


    @* Show the details *@
    <h3>Details</h3>
    <table cellpadding="0" cellspacing="0">
        <tbody>
            <tr>
                <th>
                    Level of Government
                </th>
                <td>
                    @Model.Extras.LevelOfGovernment
                </td>
            </tr>
            <tr>
                <th>
                    Agency
                </th>
                <td>
                    @Model.Extras.Agency
                </td>
            </tr>
            <tr>
                <th>
                    Update Frequency
                </th>
                <td>
                    @Model.Extras.UpdateFrequency
                </td>
            </tr>
            <tr>
                <th>
                    Temporal Coverage
                </th>
                <td>
                    @if (@Model.Extras.TemporalCoverageFrom != null)
                    {
                        @Model.Extras.TemporalCoverageFrom @:to @Model.Extras.TemporalCoverageTo
                    }
                </td>
            </tr>
        </tbody>
    </table>

</div>
